<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animated TMC Menu & Private AI Section</title>
    <style>
        /* Der feste Außen-Container, der die eigentliche Bar ist */
        .bar-fixed-container {
            background-color: rgb(82, 80, 80);
            height: 13vh;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            /* Positionierung der Bar: Fest im Viewport, 20px Abstand links/rechts */
            position: fixed;
            top: 20px; /* Ein bisschen Abstand von oben, passend zum Body-Padding */
            left: 20px;
            right: 20px;
            z-index: 1000;
            cursor: pointer;
        }

        /* Ein Wrapper innerhalb der Bar, der das relative Koordinatensystem für das Dropdown liefert */
        .menu-wrapper {
            /* Wichtig: position: relative, damit das Menü relativ dazu positioniert werden kann */
            position: relative;
            width: 100%; /* Nimmt die volle Breite der fixed-Container ein */
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Um sicherzustellen, dass die feste Bar immer sichtbar ist, muss der Body-Padding angepasst werden */
        body {
            background-color: rgb(182, 171, 158);
            margin: 0;
            padding: 20px;
            /* Sorgt dafür, dass der Inhalt unter der fixen Bar beginnt */
            padding-top: calc(13vh + 60px); 
        }

        .tmc-schrift {
            color: rgb(27, 25, 25);
            font-size: clamp(2rem, 5vw, 3rem); /* Responsiver Font-Size */
            font-weight: bold;
            text-shadow: 1px 1px 2px black;
            font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
            transition: color 0.4s ease-in-out;
        }

        .tmc-schrift:hover {
            color: rgb(158, 157, 157);
        }

        /* Hauptmenü Container */
        .menu-container {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out, opacity 0.5s ease-out;
            background-color: rgb(146, 143, 143);
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
            /* Positioniert das Menü unter dem menu-wrapper */
            position: absolute;
            width: 100%;
            left: 0;
            top: 100%; /* Startet direkt unter dem menu-wrapper */
            margin-top: 10px;
        }

        .menu-container.is-open {
            max-height: 500px; /* Groß genug, um alle Elemente aufzunehmen */
            opacity: 1;
        }

        .menu-item-link {
            padding: 15px 25px;
            border-bottom: 1px solid #ddd;
            color: rgb(0, 0, 0);
            cursor: pointer;
            transition: background-color 0.2s;
            display: block;
            text-decoration: none;
            font-size: 1.2rem;
            font-family: sans-serif;
        }

        .menu-item-link:last-child {
            border-bottom: none;
        }

        .menu-item-link:hover {
            background-color: #c9c7c7;
        }

        /* Stil für die Zielsektionen */
        .section {
            display: none; /* STANDARDMÄSSIG VERSTECKT */
            margin-top: 20px;
            margin-bottom: 20px;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            color: black;
            font-size: 1.5rem; /* Etwas kleiner für besseren Lesefluss */
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        /* Keyframe Animation für das "Pop-in" */
        @keyframes popIn {
            0% { opacity: 0; transform: scale(0.9) translateY(20px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }

        /* Zustand, wenn eine Sektion angezeigt wird */
        .section.is-active {
            display: block;
            animation: popIn 0.5s ease-out forwards; /* Animation anwenden */
        }
        
        /* Zusätzliche Stile für das Kommentarsystem */
        .submission-form {
            display: flex;
            flex-direction: column;
            gap: 15px; /* Increased gap */
            padding: 20px;
            background-color: #f0f0f0; /* Light background for form */
            border-radius: 10px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
        }

        #codeTextarea {
            width: 100%;
            padding: 15px; /* Increased padding */
            border: 1px solid #ddd;
            border-radius: 8px; /* Slightly more rounded */
            font-size: 1rem;
            box-sizing: border-box;
            resize: vertical;
            font-family: sans-serif; /* Adjusted font for general queries */
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        #codeTextarea:focus {
            border-color: #2c3e50;
            box-shadow: 0 0 0 2px rgba(44, 62, 80, 0.2);
            outline: none;
        }

        #submitButton {
            padding: 12px 25px; /* Adjusted padding */
            background-color: #2c3e50; /* Darker, professional color */
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s, box-shadow 0.3s;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        #submitButton:hover {
            background-color: #34495e;
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }

        #submitButton:active {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .submission-list {
            border-top: 2px solid #ddd;
            padding-top: 20px; /* Increased padding */
        }

        .submission-item {
            background-color: #ffffff; /* White background for submissions */
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border-left: 5px solid #2c3e50; /* Accent color for user query */
        }
        
        .ai-response {
            border-left-color: #3498db !important; /* Blue accent for AI response */
            margin-top: 15px;
        }

        .submission-meta {
            font-size: 0.9rem;
            color: #7f8c8d; /* Muted grey */
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .submission-item pre {
            background-color: #ecf0f1; /* Light code background */
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto; /* Handles horizontal scrolling for code */
            font-family: sans-serif; /* Adjusted font */
            font-size: 0.9rem;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .mt-4 {
            margin-top: 25px;
        }

        .message-area {
            font-weight: bold;
            padding: 10px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    
<div class="bar-fixed-container" onclick="toggleMenu()">
    <!-- Wrapper for the relative positioning of the menu -->
    <div class="menu-wrapper">
        <!-- TMC text displayed in the center -->
        <div class="tmc-schrift">TMC</div>
        
        <!-- The menu window that opens under the bar -->
        <div id="menuBox" class="menu-container">
            <!-- We pass the ID of the section to be displayed to the JS function -->
            <a href="#aboutSection" class="menu-item-link" onclick="showSection(event, 'aboutSection')">About me</a>
            <a href="#devSection" class="menu-item-link" onclick="showSection(event, 'devSection')">When</a>
            <a href="#siteSection" class="menu-item-link" onclick="showSection(event, 'siteSection')">Ihre Fragen an die AI</a>
            <a href="#contactSection" class="menu-item-link" onclick="showSection(event, 'contactSection')">Contact me</a>
        </div>
    </div>
</div>

<!-- Target sections on the page (All start with display: none;) -->
<div id="aboutSection" class="section">
    <h2>About me</h2>
    <p>I'm a web developer with a passion for creating beautiful and functional websites.</p>
</div>

<div id="devSection" class="section">
    <h2>When I start developing</h2>
    <p>I start developing in the 6. class</p>
</div>

<!-- SECTION WITH AI Interaction (Private) -->
<div id="siteSection" class="section">
    <h2>Stellen Sie eine Frage an die AI</h2>
    <p>Geben Sie unten Ihre Frage oder Ihren Kommentar ein. Die Antwort der AI wird nur Ihnen angezeigt und wird nicht gespeichert.</p>
    
    <!-- Submission Form -->
    <div class="submission-form mt-4">
        <textarea id="codeTextarea" rows="8" placeholder="Ihre Frage/Ihr Kommentar an die AI..."></textarea>
        <!-- HIER: Funktion wurde von 'saveSubmission' in 'sendQuery' umbenannt -->
        <button id="submitButton" onclick="sendQuery()">Senden & AI-Antwort generieren</button>
        <div id="submissionMessage" class="message-area"></div>
    </div>
    
    <!-- Private Result Container -->
    <h3 class="mt-4">Ihre Letzte Interaktion</h3>
    <div id="aiResultContainer" class="submission-list">
        <p>Stellen Sie Ihre erste Frage...</p>
    </div>
</div>

<div id="contactSection" class="section">
    <h2>Contact me</h2>
    <p>My email: timo.rusch13@gmail.com</p>
</div>


<script type="module">
    // --- GEMINI API KONFIGURATION ---
    
    // HIER: Wenn Sie die Seite außerhalb dieser Umgebung hosten, 
    // ERSETZEN Sie bitte "" durch Ihren persönlichen Google AI Studio API-Schlüssel, damit die KI funktioniert!
    // Wenn Sie die App hier testen, lassen Sie die Variable bitte leer (apiKey = "").
    const apiKey = "AIzaSyCVd5j4qhd7Gtq-aEB5hxllJZYD9oaarIY"; 
    const modelName = "gemini-2.5-flash-preview-09-2025";
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`;

    // --- AI Utility Functions ---

    /**
     * Führt einen Fetch-Request mit exponentiellem Backoff bei Fehlern (insbesondere Rate Limiting) durch.
     */
    async function fetchWithRetry(url, options, maxRetries = 3) {
        for (let i = 0; i < maxRetries; i++) {
            try {
                const response = await fetch(url, options);
                if (!response.ok) {
                    if (response.status === 429 && i < maxRetries - 1) {
                        throw new Error("Rate limit exceeded. Retrying...");
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response;
            } catch (error) {
                if (i === maxRetries - 1) {
                    throw error;
                }
                const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                await new Promise(resolve => setTimeout(resolve, delay));
            }
        }
    }

    /**
     * Generiert eine Antwort von der Gemini API.
     */
    async function generateAiResponse(userQuery) {
        const systemPrompt = "Du bist ein hilfreicher und freundlicher Assistent. Antworte auf die Benutzeranfrage in fließendem Deutsch und gib eine präzise Antwort. Deine Antwort sollte als Kommentar oder Hilfe dienen.";

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: {
                parts: [{ text: systemPrompt }]
            },
        };

        const options = {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        };

        const response = await fetchWithRetry(apiUrl, options);
        const result = await response.json();

        const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
        
        if (text) {
            return text;
        } else {
            const reason = result.candidates?.[0]?.finishReason || 'Unknown Reason';
            throw new Error(`AI generation failed: ${reason}.`);
        }
    }


    // --- AI SUBMISSION FUNCTION (No Firestore) ---
    async function sendQuery() {
        const textarea = document.getElementById('codeTextarea');
        const submitButton = document.getElementById('submitButton');
        const messageArea = document.getElementById('submissionMessage');
        const resultContainer = document.getElementById('aiResultContainer');
        const userQuery = textarea.value.trim();

        if (userQuery === "") {
            messageArea.textContent = "Bitte geben Sie Ihre Frage oder einen Kommentar ein.";
            messageArea.style.color = "orange";
            return;
        }

        // 1. Loading State
        submitButton.disabled = true;
        messageArea.textContent = "Anfrage an AI gesendet... Generiere Antwort (dies kann einen Moment dauern)..."; 
        messageArea.style.color = "blue"; 

        try {
            // 2. Generate AI Response
            const aiResponse = await generateAiResponse(userQuery);

            // 3. Display Result to User
            const time = new Date().toLocaleString('de-DE'); 
            
            const html = `
                <div class="submission-item">
                    <div class="submission-meta">
                        <strong>Ihre Anfrage:</strong> Gesendet am ${time}
                    </div>
                    <h4>Ihre Frage/Kommentar:</h4>
                    <pre>${userQuery}</pre>
                    
                    <h4 style="color: #3498db; margin-top: 15px;">AI-Antwort:</h4>
                    <pre class="ai-response">${aiResponse}</pre>
                </div>
            `;
            
            resultContainer.innerHTML = html;
            
            messageArea.textContent = "AI-Antwort erfolgreich generiert und angezeigt!";
            messageArea.style.color = "green";
            textarea.value = ''; // Clear input field

        } catch (e) {
            console.error("Error during AI generation: ", e);
            messageArea.textContent = `Fehler: ${e.message}. Die Übermittlung konnte nicht verarbeitet werden. Überprüfen Sie die Konsolen-Logs.`;
            messageArea.style.color = "red";
        } finally {
            submitButton.disabled = false;
        }
    }


    // --- MENU LOGIC ---
    // Function to toggle (open/close) the main menu
    function toggleMenu() {
        var menu = document.getElementById("menuBox");
        menu.classList.toggle("is-open");
    }

    // Function to display the selected section and close the menu
    function showSection(event, sectionId) {
        event.preventDefault(); // Prevents default link behavior (jumping)

        // Stops event propagation so the click doesn't bubble up to the parent .bar-element
        event.stopPropagation(); 
        
        // 1. Collapse the menu
        var menu = document.getElementById("menuBox");
        menu.classList.remove("is-open");

        // 2. Find all sections and remove the 'is-active' class (hide)
        var sections = document.querySelectorAll('.section');
        sections.forEach(function(section) {
            section.classList.remove("is-active");
            section.style.display = 'none';
        });
        
        // 3. Display and animate the desired section
        var targetSection = document.getElementById(sectionId);
        if (targetSection) {
            targetSection.style.display = 'block'; 
            
            // Small timeout to trigger CSS animation
            setTimeout(function() {
                 targetSection.classList.add("is-active");
                 
                 // Optional: Smoothly scroll to the new section
                 targetSection.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                 });
            }, 10);
        }
    }
    
    // Sets the global functions for the HTML click handlers
    window.sendQuery = sendQuery;
    window.toggleMenu = toggleMenu;
    window.showSection = showSection;
    
</script>

</body>

</html>
